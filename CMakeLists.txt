cmake_minimum_required(VERSION 3.30)

project(CompizCompiler VERSION 0.1)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED TRUE)

include(ExternalProject)

set(EXTERNAL_DIR ${CMAKE_CURRENT_SOURCE_DIR}/external)
set_property(DIRECTORY PROPERTY EP_PREFIX ${EXTERNAL_DIR})

ExternalProject_Add(
    antlr4-cpp-runtime

    URL https://www.antlr.org/download/antlr4-cpp-runtime-4.13.2-source.zip
    
    PATCH_COMMAND ""

    CMAKE_ARGS -DCMAKE_CXX_STANDARD=20 -DANTLR4_INSTALL=true -DCMAKE_INSTALL_PREFIX=${EXTERNAL_DIR}
)

find_package(antlr4-runtime REQUIRED PATHS ${EXTERNAL_DIR})

# CompiScript Lexer, Parser and Listener generated by ANTLR
add_library(cscript_lang STATIC 
    src/generated/CompiScriptBaseListener.cpp
    src/generated/CompiScriptListener.cpp
    src/generated/CompiScriptParser.cpp
    src/generated/CompiScriptLexer.cpp
)

add_dependencies(cscript_lang antlr4_static)

target_include_directories(cscript_lang PRIVATE 
    ${ANTLR4_INCLUDE_DIR}
)

target_link_libraries(cscript_lang PRIVATE antlr4_static)

add_executable(czc src/main.cpp
    src/SymbolTable.cpp
)

target_include_directories(czc PRIVATE src ${ANTLR4_INCLUDE_DIR})

target_link_libraries(czc PRIVATE cscript_lang antlr4_static)


